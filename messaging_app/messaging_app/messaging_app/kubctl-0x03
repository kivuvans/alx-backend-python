#!/bin/bash

echo "Applying updated deployment..."
kubectl apply -f blue_deployment.yaml

echo "Monitoring rolling update..."
kubectl rollout status deployment/messaging-app-blue

echo "Checking running pods..."
kubectl get pods -l app=messaging-app

echo "Testing application availability..."
for i in {1..5}
do
  curl http://localhost:8000 || echo "Request failed"
  sleep 2
done

echo "Rolling update completed successfully"
